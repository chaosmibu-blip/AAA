<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰“åŒ… Chrome Extension</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { font-size: 24px; color: #333; margin-bottom: 16px; }
    p { color: #666; margin-bottom: 24px; line-height: 1.6; }
    button {
      background: #6B7280;
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { background: #4B5563; transform: translateY(-2px); }
    button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
    .status {
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      display: none;
    }
    .status.show { display: block; }
    .status.success { background: #D1FAE5; color: #065F46; }
    .status.error { background: #FEE2E2; color: #991B1B; }
    .steps {
      text-align: left;
      margin-top: 24px;
      padding: 16px;
      background: #F9FAFB;
      border-radius: 8px;
    }
    .steps h3 { font-size: 14px; color: #374151; margin-bottom: 12px; }
    .steps ol { padding-left: 20px; color: #6B7280; font-size: 14px; line-height: 1.8; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“¦ æ‰“åŒ… Chrome Extension</h1>
    <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œè‡ªå‹•ç”Ÿæˆåœ–æ¨™ä¸¦æ‰“åŒ…æˆ ZIP æª”æ¡ˆ</p>

    <button id="packageBtn" onclick="packageExtension()">
      ç”Ÿæˆ ZIP æª”æ¡ˆ
    </button>

    <div id="status" class="status"></div>

    <div class="steps">
      <h3>ä¸‹è¼‰å¾Œçš„æ­¥é©Ÿï¼š</h3>
      <ol>
        <li>å‰å¾€ <a href="https://chrome.google.com/webstore/devconsole" target="_blank">Chrome é–‹ç™¼è€…å¾Œå°</a></li>
        <li>é»æ“Šã€Œæ–°å¢é …ç›®ã€</li>
        <li>ä¸Šå‚³å‰›ä¸‹è¼‰çš„ ZIP æª”æ¡ˆ</li>
        <li>å¡«å¯«æ“´å……è³‡è¨Š</li>
        <li>æäº¤å¯©æ ¸</li>
      </ol>
    </div>
  </div>

  <!-- éš±è—çš„ canvas ç”¨æ–¼ç”Ÿæˆåœ–æ¨™ -->
  <canvas id="iconCanvas" style="display:none;"></canvas>

  <script>
    // æª”æ¡ˆå…§å®¹ï¼ˆæœƒåœ¨æ‰“åŒ…æ™‚æ›¿æ›æˆå¯¦éš›å…§å®¹ï¼‰
    const files = {
      'manifest.json': `{
  "manifest_version": 3,
  "name": "æŒ‡ä»¤å°å¹«æ‰‹",
  "description": "å¿«é€Ÿè¤‡è£½å¸¸ç”¨æŒ‡ä»¤çš„æ‡¸æµ®çƒå·¥å…·ï¼Œå…§å»ºæå•æ¨¡æ¿å¹«ä½ å• AI å¥½å•é¡Œ",
  "version": "1.0.0",
  "permissions": ["storage", "clipboardWrite"],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "16": "icons/icon16.png",
      "48": "icons/icon48.png",
      "128": "icons/icon128.png"
    }
  },
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content.js"],
      "css": ["content.css"],
      "run_at": "document_end"
    }
  ],
  "background": {
    "service_worker": "background.js"
  },
  "icons": {
    "16": "icons/icon16.png",
    "48": "icons/icon48.png",
    "128": "icons/icon128.png"
  }
}`
    };

    function drawIcon(size) {
      const canvas = document.getElementById('iconCanvas');
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');
      const scale = size / 128;

      // æ¸…é™¤
      ctx.clearRect(0, 0, size, size);

      // èƒŒæ™¯åœ“å½¢
      ctx.fillStyle = '#6B7280';
      ctx.beginPath();
      ctx.arc(64 * scale, 64 * scale, 60 * scale, 0, Math.PI * 2);
      ctx.fill();

      // æ–‡ä»¶åœ–æ¨™èƒŒæ™¯
      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.moveTo(76 * scale, 28 * scale);
      ctx.lineTo(52 * scale, 28 * scale);
      ctx.quadraticCurveTo(46 * scale, 28 * scale, 46 * scale, 34 * scale);
      ctx.lineTo(46 * scale, 94 * scale);
      ctx.quadraticCurveTo(46 * scale, 100 * scale, 52 * scale, 100 * scale);
      ctx.lineTo(86 * scale, 100 * scale);
      ctx.quadraticCurveTo(92 * scale, 100 * scale, 92 * scale, 94 * scale);
      ctx.lineTo(92 * scale, 44 * scale);
      ctx.closePath();
      ctx.fill();

      // æŠ˜è§’
      ctx.beginPath();
      ctx.moveTo(76 * scale, 28 * scale);
      ctx.lineTo(76 * scale, 44 * scale);
      ctx.lineTo(92 * scale, 44 * scale);
      ctx.closePath();
      ctx.fillStyle = '#E5E7EB';
      ctx.fill();

      // æ–‡å­—ç·šæ¢
      ctx.strokeStyle = '#6B7280';
      ctx.lineWidth = Math.max(1, 4 * scale);
      ctx.lineCap = 'round';

      ctx.beginPath();
      ctx.moveTo(56 * scale, 60 * scale);
      ctx.lineTo(82 * scale, 60 * scale);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(56 * scale, 72 * scale);
      ctx.lineTo(82 * scale, 72 * scale);
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(56 * scale, 84 * scale);
      ctx.lineTo(72 * scale, 84 * scale);
      ctx.stroke();

      return new Promise(resolve => {
        canvas.toBlob(blob => resolve(blob), 'image/png');
      });
    }

    async function fetchFile(url) {
      try {
        const response = await fetch(url);
        return await response.text();
      } catch (e) {
        console.error('Failed to fetch:', url, e);
        return null;
      }
    }

    async function packageExtension() {
      const btn = document.getElementById('packageBtn');
      const status = document.getElementById('status');

      btn.disabled = true;
      btn.textContent = 'æ‰“åŒ…ä¸­...';
      status.className = 'status';
      status.style.display = 'none';

      try {
        const zip = new JSZip();

        // ç”Ÿæˆåœ–æ¨™
        const icon16 = await drawIcon(16);
        const icon48 = await drawIcon(48);
        const icon128 = await drawIcon(128);

        zip.file('icons/icon16.png', icon16);
        zip.file('icons/icon48.png', icon48);
        zip.file('icons/icon128.png', icon128);

        // æ·»åŠ å…¶ä»–æª”æ¡ˆ
        const baseUrl = window.location.href.replace('package-extension.html', '');

        const filesToFetch = [
          'manifest.json',
          'content.js',
          'content.css',
          'background.js',
          'popup.html'
        ];

        for (const file of filesToFetch) {
          const content = await fetchFile(baseUrl + file);
          if (content) {
            zip.file(file, content);
          }
        }

        // ç”Ÿæˆ ZIP
        const blob = await zip.generateAsync({ type: 'blob' });

        // ä¸‹è¼‰
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'command-helper-extension.zip';
        link.click();

        status.textContent = 'âœ… ZIP æª”æ¡ˆå·²ä¸‹è¼‰ï¼';
        status.className = 'status show success';
        btn.textContent = 'é‡æ–°ä¸‹è¼‰';

      } catch (error) {
        console.error(error);
        status.textContent = 'âŒ æ‰“åŒ…å¤±æ•—ï¼š' + error.message;
        status.className = 'status show error';
        btn.textContent = 'é‡è©¦';
      }

      btn.disabled = false;
    }
  </script>
</body>
</html>
